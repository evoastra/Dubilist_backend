generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Role {
  id               Int                @id @default(autoincrement())
  name             String             @unique @db.VarChar(50)
  description      String?            @db.VarChar(255)
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  role_permissions role_permissions[]
  users            User[]

  @@map("roles")
}

model User {
  id                      Int                    @id @default(autoincrement())
  name                    String                 @db.VarChar(100)
  email                   String                 @unique @db.VarChar(255)
  phone                   String?                @db.VarChar(20)
  passwordHash            String?                @map("password_hash") @db.VarChar(255)
  roleId                  Int                    @map("role_id")
  isVerified              Boolean                @default(false) @map("is_verified")
  isBlocked               Boolean                @default(false) @map("is_blocked")
  avatarUrl               String?                @map("avatar_url") @db.VarChar(500)
  bio                     String?                @db.Text
  lastLoginAt             DateTime?              @map("last_login_at")
  lastListingPostedAt     DateTime?              @map("last_listing_posted_at")
  lastChatMessageAt       DateTime?              @map("last_chat_message_at")
  isDeleted               Boolean                @default(false) @map("is_deleted")
  deletedAt               DateTime?              @map("deleted_at")
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")
  avatarS3Key             String?                @map("avatar_s3_key") @db.VarChar(500)
  can_post_listings       Boolean                @default(true)
  resetPasswordExpires    DateTime?              @map("reset_password_expires")
  resetPasswordToken      String?                @map("reset_password_token") @db.VarChar(255)
  admin_notes             admin_notes[]
  audit_logs              audit_logs[]
  chatMessages            ChatMessage[]
  chatRoomsAsBuyer        ChatRoom[]             @relation("BuyerChats")
  chatRoomsAsSeller       ChatRoom[]             @relation("SellerChats")
  designerBookings        DesignerBooking[]
  designerReviews         DesignerReview[]
  designer                Designer?
  favorites               Favorite[]
  fraudLogs               FraudLog[]
  reviewedJobApplications JobApplication[]       @relation("ReviewedApplications")
  jobApplications         JobApplication[]       @relation("UserApplications")
  listings                Listing[]
  notifications           Notification[]
  recentlyViewed          RecentlyViewed[]
  refreshTokens           RefreshToken[]
  listingReports          ReportedListing[]
  reportsAgainstMe        ReportedUser[]         @relation("ReportedUser")
  reportedByMe            ReportedUser[]         @relation("Reporter")
  supportMessages         SupportTicketMessage[]
  supportTickets          SupportTicket[]
  role                    Role                   @relation(fields: [roleId], references: [id])

  @@index([email])
  @@index([phone])
  @@index([roleId])
  @@index([isBlocked])
  @@index([createdAt])
  @@map("users")
}

model JobApplication {
  id                Int                  @id @default(autoincrement())
  jobListingId      Int                  @map("job_listing_id")
  userId            Int                  @map("user_id")
  name              String               @db.VarChar(100)
  dob               DateTime?            @map("dob")
  email             String               @db.VarChar(255)
  mobileNo          String               @map("mobile_no") @db.VarChar(20)
  languages         Json?
  nationality       String?              @db.VarChar(100)
  location          String?              @db.VarChar(200)
  visaStatus        String?              @map("visa_status") @db.VarChar(100)
  resumeUrl         String               @map("resume_url") @db.VarChar(500)
  resumeS3Key       String?              @map("resume_s3_key") @db.VarChar(500)
  qualification     String?              @db.VarChar(255)
  jobStatus         String               @map("job_status") @db.VarChar(50)
  yearsOfExperience Int?                 @map("years_of_experience")
  salaryExpectation Float?               @map("salary_expectation")
  salaryCurrency    String               @default("AED") @map("salary_currency") @db.VarChar(10)
  coverLetter       String?              @map("cover_letter") @db.Text
  portfolioUrl      String?              @map("portfolio_url") @db.VarChar(500)
  linkedinUrl       String?              @map("linkedin_url") @db.VarChar(500)
  status            JobApplicationStatus @default(pending)
  employerNotes     String?              @map("employer_notes") @db.Text
  reviewedAt        DateTime?            @map("reviewed_at")
  reviewedBy        Int?                 @map("reviewed_by")
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  jobListing        Listing              @relation("JobApplications", fields: [jobListingId], references: [id], onDelete: Cascade)
  reviewer          User?                @relation("ReviewedApplications", fields: [reviewedBy], references: [id])
  user              User                 @relation("UserApplications", fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobListingId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([reviewedBy], map: "job_applications_reviewed_by_fkey")
  @@map("job_applications")
}

model RefreshToken {
  id        Int       @id @default(autoincrement())
  userId    Int       @map("user_id")
  tokenHash String    @map("token_hash") @db.VarChar(255)
  expiresAt DateTime  @map("expires_at")
  revokedAt DateTime? @map("revoked_at")
  createdAt DateTime  @default(now()) @map("created_at")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model Category {
  id          Int        @id @default(autoincrement())
  name        String     @db.VarChar(100)
  slug        String     @unique @db.VarChar(100)
  description String?    @db.Text
  iconUrl     String?    @map("icon_url") @db.VarChar(500)
  parentId    Int?       @map("parent_id")
  isActive    Boolean    @default(true) @map("is_active")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  imageUrl    String?    @map("image_url") @db.VarChar(500)
  orderIndex  Int        @default(0) @map("order_index")
  s3Key       String?    @map("s3_key") @db.VarChar(500)
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  listings    Listing[]

  @@index([parentId])
  @@index([slug])
  @@map("categories")
}

model Listing {
  id                Int                @id @default(autoincrement())
  userId            Int                @map("user_id")
  title             String             @db.VarChar(255)
  description       String             @db.Text
  price             Decimal            @db.Decimal(12, 2)
  currency          String             @default("AED") @db.VarChar(10)
  categoryId        Int                @map("category_id")
  city              String?            @db.VarChar(100)
  country           String?            @db.VarChar(100)
  address           String?            @db.VarChar(500)
  latitude          Decimal?           @db.Decimal(10, 8)
  longitude         Decimal?           @db.Decimal(11, 8)
  status            ListingStatus      @default(draft)
  reasonRejected    String?            @map("reason_rejected") @db.Text
  viewsCount        Int                @default(0) @map("views_count")
  favoritesCount    Int                @default(0) @map("favorites_count")
  contactPhone      String?            @map("contact_phone") @db.VarChar(20)
  contactEmail      String?            @map("contact_email") @db.VarChar(255)
  isNegotiable      Boolean            @default(true) @map("is_negotiable")
  isDeleted         Boolean            @default(false) @map("is_deleted")
  deletedAt         DateTime?          @map("deleted_at")
  expiresAt         DateTime?          @map("expires_at")
  publishedAt       DateTime?          @map("published_at")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  contactWhatsapp   String?            @map("contact_whatsapp") @db.VarChar(20)
  featuredUntil     DateTime?          @map("featured_until")
  isFeatured        Boolean            @default(false) @map("is_featured")
  admin_notes       admin_notes[]
  chatRooms         ChatRoom[]
  classifiedDetails ClassifiedListing?
  electronicDetails ElectronicListing?
  favorites         Favorite[]
  furnitureDetails  FurnitureListing?
  jobApplications   JobApplication[]   @relation("JobApplications")
  jobDetails        JobListing?
  images            ListingImage[]
  category          Category           @relation(fields: [categoryId], references: [id])
  user              User               @relation(fields: [userId], references: [id])
  motorDetails      MotorListing?
  propertyDetails   PropertyListing?
  recentlyViewed    RecentlyViewed[]
  reports           ReportedListing[]

  @@index([userId])
  @@index([categoryId])
  @@index([status])
  @@index([status, createdAt])
  @@index([price])
  @@index([city])
  @@index([isFeatured])
  @@index([createdAt])
  @@map("listings")
}

model ListingImage {
  id         Int      @id @default(autoincrement())
  listingId  Int      @map("listing_id")
  imageUrl   String   @map("image_url") @db.VarChar(500)
  s3Key      String?  @map("s3_key") @db.VarChar(500)
  orderIndex Int      @default(0) @map("order_index")
  isPrimary  Boolean  @default(false) @map("is_primary")
  createdAt  DateTime @default(now()) @map("created_at")
  listing    Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([listingId])
  @@index([orderIndex])
  @@map("listing_images")
}

model MotorListing {
  id              Int      @id @default(autoincrement())
  listingId       Int      @unique @map("listing_id")
  name            String?  @db.VarChar(100)
  phone           String?  @db.VarChar(20)
  make            String   @db.VarChar(100)
  model           String   @db.VarChar(100)
  variant         String?  @db.VarChar(100)
  year            Int
  kilometres      Int?
  hoursUsed       Int?     @map("hours_used")
  transmission    String?  @db.VarChar(50)
  fuelType        String?  @map("fuel_type") @db.VarChar(50)
  bodyType        String?  @map("body_type") @db.VarChar(50)
  motorType       String?  @map("motor_type") @db.VarChar(50)
  engineSize      Int?     @map("engine_size")
  cylinders       Int?
  horsepower      Int?
  payloadCapacity Int?     @map("payload_capacity")
  seatingCapacity Int?     @map("seating_capacity")
  condition       String?  @db.VarChar(50)
  color           String?  @db.VarChar(50)
  interiorColor   String?  @map("interior_color") @db.VarChar(50)
  warranty        String?  @db.VarChar(100)
  serviceHistory  Boolean? @map("service_history")
  features        Json?
  images          Json?
  images_s3_keys  Json?
  specs           Json?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  price           Decimal? @db.Decimal(12, 2)
  currency        String?  @default("AED") @db.VarChar(10)
  listing         Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([make])
  @@index([year])
  @@index([transmission])
  @@index([fuelType])
  @@index([bodyType])
  @@map("motor_listings")
}

model JobListing {
  id                     Int       @id @default(autoincrement())
  listingId              Int       @unique @map("listing_id")
  name                   String?   @db.VarChar(100)
  phone                  String?   @db.VarChar(20)
  price                  Decimal?  @db.Decimal(12, 2)
  currency               String?   @default("AED") @db.VarChar(10)
  jobTitle               String    @map("job_title") @db.VarChar(200)
  companyName            String    @map("company_name") @db.VarChar(200)
  companyLogoUrl         String?   @map("company_logo_url") @db.VarChar(500)
  companyLogoS3Key       String?   @map("company_logo_s3_key") @db.VarChar(500)
  industry               String    @db.VarChar(100)
  jobType                String    @map("job_type") @db.VarChar(50)
  workplaceType          String?   @map("workplace_type") @db.VarChar(50)
  experienceMin          Int?      @map("experience_min")
  experienceMax          Int?      @map("experience_max")
  experienceLevel        String?   @map("experience_level") @db.VarChar(50)
  educationRequired      String?   @map("education_required") @db.VarChar(100)
  salaryMin              Decimal?  @map("salary_min") @db.Decimal(12, 2)
  salaryMax              Decimal?  @map("salary_max") @db.Decimal(12, 2)
  salaryPeriod           String?   @map("salary_period") @db.VarChar(20)
  hideSalary             Boolean   @default(false) @map("hide_salary")
  skillsRequired         Json?     @map("skills_required")
  languagesRequired      Json?     @map("languages_required")
  certificationsRequired Json?     @map("certifications_required")
  benefits               Json?
  responsibilities       Json?
  numberOfPositions      Int       @default(1) @map("number_of_positions")
  applicationDeadline    DateTime? @map("application_deadline")
  applicationEmail       String?   @map("application_email") @db.VarChar(255)
  applicationUrl         String?   @map("application_url") @db.VarChar(500)
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")
  listing                Listing   @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([industry])
  @@index([jobType])
  @@index([experienceLevel])
  @@map("job_listings")
}

model PropertyListing {
  id              Int       @id @default(autoincrement())
  listingId       Int       @unique @map("listing_id")
  name            String?   @db.VarChar(100)
  phone           String?   @db.VarChar(20)
  price           Decimal?  @db.Decimal(12, 2)
  currency        String?   @default("AED") @db.VarChar(10)
  listingType     String    @map("listing_type") @db.VarChar(20)
  propertyType    String    @map("property_type") @db.VarChar(50)
  bedrooms        Int?
  bathrooms       Int?
  halls           Int?
  areaSqft        Decimal?  @map("area_sqft") @db.Decimal(10, 2)
  plotSizeSqft    Decimal?  @map("plot_size_sqft") @db.Decimal(10, 2)
  floorNumber     Int?      @map("floor_number")
  totalFloors     Int?      @map("total_floors")
  buildingAge     Int?      @map("building_age")
  buildingName    String?   @map("building_name") @db.VarChar(200)
  furnishing      String?   @db.VarChar(50)
  condition       String?   @db.VarChar(50)
  parkingSpaces   Int?      @map("parking_spaces")
  rentFrequency   String?   @map("rent_frequency") @db.VarChar(20)
  securityDeposit Decimal?  @map("security_deposit") @db.Decimal(12, 2)
  numberOfCheques Int?      @map("number_of_cheques")
  amenities       Json?
  nearbyPlaces    Json?     @map("nearby_places")
  ownershipType   String?   @map("ownership_type") @db.VarChar(50)
  developerName   String?   @map("developer_name") @db.VarChar(200)
  projectName     String?   @map("project_name") @db.VarChar(200)
  completionDate  DateTime? @map("completion_date")
  images          Json?
  images_s3_keys  Json?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  listing         Listing   @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([listingType])
  @@index([propertyType])
  @@index([bedrooms])
  @@index([furnishing])
  @@map("property_listings")
}

model ClassifiedListing {
  id             Int      @id @default(autoincrement())
  listingId      Int      @unique @map("listing_id")
  name           String?  @db.VarChar(100)
  phone          String?  @db.VarChar(20)
  price          Decimal? @db.Decimal(12, 2)
  currency       String?  @default("AED") @db.VarChar(10)
  subCategory    String   @map("sub_category") @db.VarChar(100)
  condition      String   @db.VarChar(50)
  brand          String?  @db.VarChar(100)
  model          String?  @db.VarChar(100)
  material       String?  @db.VarChar(100)
  color          String?  @db.VarChar(50)
  size           String?  @db.VarChar(50)
  weight         Decimal? @db.Decimal(10, 2)
  lengthCm       Decimal? @map("length_cm") @db.Decimal(10, 2)
  widthCm        Decimal? @map("width_cm") @db.Decimal(10, 2)
  heightCm       Decimal? @map("height_cm") @db.Decimal(10, 2)
  gender         String?  @db.VarChar(20)
  ageGroup       String?  @map("age_group") @db.VarChar(50)
  quantity       Int      @default(1)
  isHandmade     Boolean? @map("is_handmade")
  yearOfPurchase Int?     @map("year_of_purchase")
  warranty       String?  @db.VarChar(100)
  features       Json?
  images         Json?
  images_s3_keys Json?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  listing        Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([subCategory])
  @@index([condition])
  @@index([brand])
  @@map("classified_listings")
}

model ElectronicListing {
  id              Int       @id @default(autoincrement())
  listingId       Int       @unique @map("listing_id")
  name            String?   @db.VarChar(100)
  phone           String?   @db.VarChar(20)
  price           Decimal?  @db.Decimal(12, 2)
  currency        String?   @default("AED") @db.VarChar(10)
  subCategory     String    @map("sub_category") @db.VarChar(100)
  brand           String    @db.VarChar(100)
  model           String    @db.VarChar(100)
  modelNumber     String?   @map("model_number") @db.VarChar(100)
  condition       String    @db.VarChar(50)
  storage         String?   @db.VarChar(50)
  ram             String?   @db.VarChar(50)
  processor       String?   @db.VarChar(100)
  operatingSystem String?   @map("operating_system") @db.VarChar(50)
  screenSize      Decimal?  @map("screen_size") @db.Decimal(5, 2)
  resolution      String?   @db.VarChar(50)
  displayType     String?   @map("display_type") @db.VarChar(50)
  capacity        String?   @db.VarChar(50)
  energyRating    String?   @map("energy_rating") @db.VarChar(10)
  wattage         Int?
  color           String?   @db.VarChar(50)
  weight          Decimal?  @db.Decimal(10, 2)
  lengthCm        Decimal?  @map("length_cm") @db.Decimal(10, 2)
  widthCm         Decimal?  @map("width_cm") @db.Decimal(10, 2)
  heightCm        Decimal?  @map("height_cm") @db.Decimal(10, 2)
  warrantyStatus  String?   @map("warranty_status") @db.VarChar(50)
  warrantyExpiry  DateTime? @map("warranty_expiry")
  purchaseDate    DateTime? @map("purchase_date")
  hasOriginalBox  Boolean?  @map("has_original_box")
  hasCharger      Boolean?  @map("has_charger")
  accessories     Json?
  imeiNumber      String?   @map("imei_number") @db.VarChar(20)
  serialNumber    String?   @map("serial_number") @db.VarChar(100)
  features        Json?
  images          Json?
  images_s3_keys  Json?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  listing         Listing   @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([subCategory])
  @@index([brand])
  @@index([condition])
  @@map("electronic_listings")
}

model FurnitureListing {
  id                Int      @id @default(autoincrement())
  listingId         Int      @unique @map("listing_id")
  name              String?  @db.VarChar(100)
  phone             String?  @db.VarChar(20)
  price             Decimal? @db.Decimal(12, 2)
  currency          String?  @default("AED") @db.VarChar(10)
  subCategory       String   @map("sub_category") @db.VarChar(100)
  condition         String   @db.VarChar(50)
  style             String?  @db.VarChar(50)
  primaryMaterial   String?  @map("primary_material") @db.VarChar(100)
  secondaryMaterial String?  @map("secondary_material") @db.VarChar(100)
  woodType          String?  @map("wood_type") @db.VarChar(50)
  color             String?  @db.VarChar(50)
  finish            String?  @db.VarChar(50)
  lengthCm          Decimal? @map("length_cm") @db.Decimal(10, 2)
  widthCm           Decimal? @map("width_cm") @db.Decimal(10, 2)
  heightCm          Decimal? @map("height_cm") @db.Decimal(10, 2)
  weight            Decimal? @db.Decimal(10, 2)
  seatingCapacity   Int?     @map("seating_capacity")
  bedSize           String?  @map("bed_size") @db.VarChar(50)
  mattressIncluded  Boolean? @map("mattress_included")
  numberOfDrawers   Int?     @map("number_of_drawers")
  numberOfShelves   Int?     @map("number_of_shelves")
  storageCapacity   String?  @map("storage_capacity") @db.VarChar(50)
  assemblyRequired  Boolean? @map("assembly_required")
  deliveryAvailable Boolean? @map("delivery_available")
  brand             String?  @db.VarChar(100)
  setOf             Int?     @map("set_of")
  features          Json?
  images            Json?
  images_s3_keys    Json?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  listing           Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([subCategory])
  @@index([condition])
  @@index([primaryMaterial])
  @@map("furniture_listings")
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  listingId Int      @map("listing_id")
  imagesS3Keys   Json?    @map("images_s3_keys")
  createdAt DateTime @default(now()) @map("created_at")
  images    Json?
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([userId])
  @@index([listingId])
  @@map("favorites")
}

model RecentlyViewed {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  listingId Int      @map("listing_id")
  viewedAt  DateTime @default(now()) @map("viewed_at")
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([userId])
  @@index([viewedAt])
  @@index([listingId], map: "recently_viewed_listing_id_fkey")
  @@map("recently_viewed")
}

model ChatRoom {
  id        Int           @id @default(autoincrement())
  listingId Int           @map("listing_id")
  buyerId   Int           @map("buyer_id")
  sellerId  Int           @map("seller_id")
  isBlocked Boolean       @default(false) @map("is_blocked")
  blockedBy Int?          @map("blocked_by")
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")
  messages  ChatMessage[]
  buyer     User          @relation("BuyerChats", fields: [buyerId], references: [id])
  listing   Listing       @relation(fields: [listingId], references: [id], onDelete: Cascade)
  seller    User          @relation("SellerChats", fields: [sellerId], references: [id])

  @@unique([listingId, buyerId, sellerId])
  @@index([buyerId])
  @@index([sellerId])
  @@index([listingId])
  @@map("chat_rooms")
}

model ChatMessage {
  id        Int       @id @default(autoincrement())
  roomId    Int       @map("room_id")
  senderId  Int       @map("sender_id")
  content   String    @db.Text
  isRead    Boolean   @default(false) @map("is_read")
  readAt    DateTime? @map("read_at")
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")
  createdAt DateTime  @default(now()) @map("created_at")
  room      ChatRoom  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  sender    User      @relation(fields: [senderId], references: [id])

  @@index([roomId])
  @@index([senderId])
  @@index([roomId, createdAt])
  @@index([isRead])
  @@map("chat_messages")
}

model ReportedUser {
  id             Int          @id @default(autoincrement())
  reportedUserId Int          @map("reported_user_id")
  reporterId     Int          @map("reporter_id")
  reason         String       @db.VarChar(255)
  details        String?      @db.Text
  status         ReportStatus @default(pending)
  reviewedBy     Int?         @map("reviewed_by")
  reviewedAt     DateTime?    @map("reviewed_at")
  createdAt      DateTime     @default(now()) @map("created_at")
  reportedUser   User         @relation("ReportedUser", fields: [reportedUserId], references: [id])
  reporter       User         @relation("Reporter", fields: [reporterId], references: [id])

  @@index([reportedUserId])
  @@index([reporterId])
  @@index([status])
  @@map("reported_users")
}

model ReportedListing {
  id         Int          @id @default(autoincrement())
  listingId  Int          @map("listing_id")
  reporterId Int          @map("reporter_id")
  reason     String       @db.VarChar(255)
  details    String?      @db.Text
  status     ReportStatus @default(pending)
  reviewedBy Int?         @map("reviewed_by")
  reviewedAt DateTime?    @map("reviewed_at")
  createdAt  DateTime     @default(now()) @map("created_at")
  listing    Listing      @relation(fields: [listingId], references: [id], onDelete: Cascade)
  reporter   User         @relation(fields: [reporterId], references: [id])

  @@index([listingId])
  @@index([reporterId])
  @@index([status])
  @@map("reported_listings")
}

model FraudLog {
  id         Int      @id @default(autoincrement())
  userId     Int?     @map("user_id")
  type       String   @db.VarChar(100)
  details    Json
  riskScore  Int      @map("risk_score")
  isReviewed Boolean  @default(false) @map("is_reviewed")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([riskScore])
  @@index([createdAt])
  @@map("fraud_logs")
}

model SearchLog {
  id           Int      @id @default(autoincrement())
  userId       Int?     @map("user_id")
  query        String   @db.VarChar(500)
  filters      Json?
  resultsCount Int      @default(0) @map("results_count")
  ipAddress    String?  @map("ip_address") @db.VarChar(50)
  createdAt    DateTime @default(now()) @map("created_at")
  images       Json?

  @@index([createdAt])
  @@map("search_logs")
}

model SupportTicket {
  id        Int                    @id @default(autoincrement())
  userId    Int?                   @map("user_id")
  subject   String                 @db.VarChar(255)
  message   String                 @db.Text
  status    TicketStatus           @default(open)
  priority  TicketPriority         @default(medium)
  createdAt DateTime               @default(now()) @map("created_at")
  updatedAt DateTime               @updatedAt @map("updated_at")
  messages  SupportTicketMessage[]
  user      User?                  @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@map("support_tickets")
}

model SupportTicketMessage {
  id         Int           @id @default(autoincrement())
  ticketId   Int           @map("ticket_id")
  senderId   Int?          @map("sender_id")
  senderType String        @map("sender_type") @db.VarChar(20)
  message    String        @db.Text
  createdAt  DateTime      @default(now()) @map("created_at")
  sender     User?         @relation(fields: [senderId], references: [id])
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([senderId])
  @@map("support_ticket_messages")
}

model Notification {
  id        Int              @id @default(autoincrement())
  userId    Int              @map("user_id")
  type      NotificationType
  title     String           @db.VarChar(255)
  message   String           @db.Text
  data      Json?
  isRead    Boolean          @default(false) @map("is_read")
  readAt    DateTime?        @map("read_at")
  createdAt DateTime         @default(now()) @map("created_at")
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([createdAt])
  @@map("notifications")
}

model SystemConfig {
  id        Int      @id @default(autoincrement())
  key       String   @unique @db.VarChar(100)
  value     String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("system_config")
}

model Designer {
  id                 Int                 @id @default(autoincrement())
  userId             Int                 @unique @map("user_id")
  bio                String              @db.Text
  tagline            String?             @db.VarChar(255)
  location           String              @db.VarChar(200)
  city               String?             @db.VarChar(100)
  country            String?             @db.VarChar(100)
  latitude           Decimal?            @db.Decimal(10, 8)
  longitude          Decimal?            @db.Decimal(11, 8)
  serviceRadius      Int?                @map("service_radius")
  services           Json
  specializations    Json?
  hourlyRate         Decimal?            @map("hourly_rate") @db.Decimal(10, 2)
  consultationFee    Decimal?            @map("consultation_fee") @db.Decimal(10, 2)
  currency           String              @default("AED") @db.VarChar(10)
  photos             Json?
  portfolioUrl       String?             @map("portfolio_url") @db.VarChar(500)
  yearsExperience    Int?                @map("years_experience")
  certifications     Json?
  education          String?             @db.Text
  languages          Json?
  availableDays      Json?               @map("available_days")
  availableTimeStart String?             @map("available_time_start") @db.VarChar(10)
  availableTimeEnd   String?             @map("available_time_end") @db.VarChar(10)
  isAvailable        Boolean             @default(true) @map("is_available")
  rating             Decimal             @default(0.00) @db.Decimal(3, 2)
  totalReviews       Int                 @default(0) @map("total_reviews")
  completedProjects  Int                 @default(0) @map("completed_projects")
  isVerified         Boolean             @default(false) @map("is_verified")
  verifiedAt         DateTime?           @map("verified_at")
  isActive           Boolean             @default(true) @map("is_active")
  isFeatured         Boolean             @default(false) @map("is_featured")
  featuredUntil      DateTime?           @map("featured_until")
  isDeleted          Boolean             @default(false) @map("is_deleted")
  deletedAt          DateTime?           @map("deleted_at")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  bookings           DesignerBooking[]
  portfolioItems     DesignerPortfolio[]
  reviews            DesignerReview[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([location])
  @@index([city])
  @@index([isActive])
  @@index([isVerified])
  @@index([rating])
  @@index([createdAt])
  @@map("designers")
}

model DesignerPortfolio {
  id           Int       @id @default(autoincrement())
  designerId   Int       @map("designer_id")
  title        String    @db.VarChar(255)
  description  String?   @db.Text
  projectType  String    @map("project_type") @db.VarChar(100)
  style        String?   @db.VarChar(100)
  images       Json
  beforeImages Json?     @map("before_images")
  afterImages  Json?     @map("after_images")
  location     String?   @db.VarChar(200)
  area         Int?
  budget       String?   @db.VarChar(100)
  duration     String?   @db.VarChar(100)
  completedAt  DateTime? @map("completed_at")
  tags         Json?
  isFeatured   Boolean   @default(false) @map("is_featured")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  designer     Designer  @relation(fields: [designerId], references: [id], onDelete: Cascade)

  @@index([designerId])
  @@index([projectType])
  @@map("designer_portfolios")
}

model DesignerBooking {
  id                 Int             @id @default(autoincrement())
  designerId         Int             @map("designer_id")
  userId             Int             @map("user_id")
  dateTime           DateTime        @map("date_time")
  duration           Int             @default(60)
  endTime            DateTime?       @map("end_time")
  bookingType        String          @map("booking_type") @db.VarChar(50)
  status             BookingStatus   @default(pending)
  userNotes          String?         @map("user_notes") @db.Text
  designerNotes      String?         @map("designer_notes") @db.Text
  cancelledBy        Int?            @map("cancelled_by")
  cancelledAt        DateTime?       @map("cancelled_at")
  cancellationReason String?         @map("cancellation_reason") @db.Text
  rejectionReason    String?         @map("rejection_reason") @db.Text
  meetingType        String?         @map("meeting_type") @db.VarChar(50)
  meetingLocation    String?         @map("meeting_location") @db.Text
  meetingLink        String?         @map("meeting_link") @db.VarChar(500)
  fee                Decimal?        @db.Decimal(10, 2)
  currency           String          @default("AED") @db.VarChar(10)
  isPaid             Boolean         @default(false) @map("is_paid")
  paidAt             DateTime?       @map("paid_at")
  confirmedAt        DateTime?       @map("confirmed_at")
  completedAt        DateTime?       @map("completed_at")
  reminderSent       Boolean         @default(false) @map("reminder_sent")
  reminderSentAt     DateTime?       @map("reminder_sent_at")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  projectDescription String?         @map("project_description") @db.Text
  projectType        String?         @map("project_type") @db.VarChar(100)
  userAddress        String?         @map("user_address") @db.VarChar(500)
  userName           String?         @map("user_name") @db.VarChar(100)
  userPhone          String?         @map("user_phone") @db.VarChar(20)
  designer           Designer        @relation(fields: [designerId], references: [id], onDelete: Cascade)
  user               User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  review             DesignerReview?

  @@index([designerId])
  @@index([userId])
  @@index([status])
  @@index([dateTime])
  @@index([createdAt])
  @@map("designer_bookings")
}

model DesignerReview {
  id                    Int              @id @default(autoincrement())
  designerId            Int              @map("designer_id")
  userId                Int              @map("user_id")
  bookingId             Int?             @unique @map("booking_id")
  rating                Int
  communicationRating   Int?             @map("communication_rating")
  professionalismRating Int?             @map("professionalism_rating")
  qualityRating         Int?             @map("quality_rating")
  valueRating           Int?             @map("value_rating")
  title                 String?          @db.VarChar(255)
  comment               String           @db.Text
  photos                Json?
  response              String?          @db.Text
  respondedAt           DateTime?        @map("responded_at")
  isApproved            Boolean          @default(false) @map("is_approved")
  approvedAt            DateTime?        @map("approved_at")
  approvedBy            Int?             @map("approved_by")
  isHidden              Boolean          @default(false) @map("is_hidden")
  hiddenReason          String?          @map("hidden_reason") @db.VarChar(255)
  helpfulCount          Int              @default(0) @map("helpful_count")
  createdAt             DateTime         @default(now()) @map("created_at")
  updatedAt             DateTime         @updatedAt @map("updated_at")
  booking               DesignerBooking? @relation(fields: [bookingId], references: [id])
  designer              Designer         @relation(fields: [designerId], references: [id], onDelete: Cascade)
  user                  User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([designerId])
  @@index([userId])
  @@index([rating])
  @@index([isApproved])
  @@index([createdAt])
  @@map("designer_reviews")
}

model admin_notes {
  id             Int      @id @default(autoincrement())
  listing_id     Int
  admin_id       Int
  content        String   @db.Text
  is_internal    Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime
  images         Json?
  images_s3_keys Json?
  users          User     @relation(fields: [admin_id], references: [id], onDelete: Cascade)
  listings       Listing  @relation(fields: [listing_id], references: [id], onDelete: Cascade)

  @@index([admin_id])
  @@index([created_at])
  @@index([listing_id])
}

model audit_logs {
  id            Int      @id @default(autoincrement())
  actor_user_id Int?
  action        String   @db.VarChar(100)
  entity_type   String?  @db.VarChar(50)
  entity_id     Int?
  metadata      Json?
  ip_address    String?  @db.VarChar(50)
  device_info   Json?
  created_at    DateTime @default(now())
  users         User?    @relation(fields: [actor_user_id], references: [id])

  @@index([action])
  @@index([actor_user_id])
  @@index([created_at])
  @@index([entity_type, entity_id])
}

model permissions {
  id               Int                @id @default(autoincrement())
  name             String             @unique @db.VarChar(100)
  description      String?            @db.VarChar(255)
  category         String?            @db.VarChar(50)
  created_at       DateTime           @default(now())
  role_permissions role_permissions[]
}
model OtpRequest {
  id         Int       @id @default(autoincrement())
  userId     Int?
  phone      String?   // Make optional
  email      String?   // Add this field
  otpHash    String
  attempts   Int       @default(0)
  expiresAt  DateTime
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([phone])
  @@index([email])   // Add this index
  @@index([expiresAt])
}
model role_permissions {
  id            Int         @id @default(autoincrement())
  role_id       Int
  permission_id Int
  created_at    DateTime    @default(now())
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  roles         Role        @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([role_id, permission_id])
  @@index([permission_id])
  @@index([role_id])
}

enum JobApplicationStatus {
  pending
  reviewing
  shortlisted
  rejected
  accepted

  @@map("job_application_status")
}

enum ListingStatus {
  draft
  pending
  approved
  rejected
  sold
  expired
  completed

  @@map("listing_status")
}

enum ReportStatus {
  pending
  reviewed
  dismissed
  actioned

  @@map("report_status")
}

enum TicketStatus {
  open
  in_progress
  resolved
  closed

  @@map("ticket_status")
}

enum TicketPriority {
  low
  medium
  high
  urgent

  @@map("ticket_priority")
}

enum NotificationType {
  listing_approved
  listing_rejected
  listing_expired
  new_message
  price_alert
  new_favorite
  support_reply
  system
  booking_request
  booking_confirmed
  booking_rejected
  booking_cancelled
  booking_reminder
  new_review
  review_response

  @@map("notification_type")
}

enum BookingStatus {
  pending
  confirmed
  rejected
  cancelled
  completed
  no_show

  @@map("booking_status")
}
